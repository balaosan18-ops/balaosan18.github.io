<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>高级图片压缩工具</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link href="https://cdn.jsdelivr.net/npm/font-awesome@4.7.0/css/font-awesome.min.css" rel="stylesheet">
  
  <!-- 配置Tailwind -->
  <script>
    tailwind.config = {
      theme: {
        extend: {
          colors: {
            primary: '#3B82F6',
            secondary: '#10B981',
            accent: '#8B5CF6',
            neutral: '#1F2937',
          },
          fontFamily: {
            inter: ['Inter', 'system-ui', 'sans-serif'],
          },
        },
      }
    }
  </script>
  
  <style type="text/tailwindcss">
    @layer utilities {
      .content-auto {
        content-visibility: auto;
      }
      .transition-custom {
        transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
      }
      .shadow-custom {
        box-shadow: 0 10px 25px -5px rgba(0, 0, 0, 0.1), 0 8px 10px -6px rgba(0, 0, 0, 0.1);
      }
      .gradient-bg {
        background: linear-gradient(135deg, #3B82F6 0%, #8B5CF6 100%);
      }
    }
  </style>
</head>
<body class="font-inter bg-gray-50 min-h-screen">
  <!-- 顶部导航 -->
  <header class="gradient-bg text-white shadow-lg">
    <div class="container mx-auto px-4 py-6">
      <div class="flex justify-between items-center">
        <div class="flex items-center space-x-2">
          <i class="fa fa-compress text-2xl"></i>
          <h1 class="text-[clamp(1.5rem,3vw,2rem)] font-bold">图片压缩工具</h1>
        </div>
        <div class="hidden md:flex items-center space-x-6">
          <a href="#" class="hover:text-gray-200 transition-custom flex items-center">
            <i class="fa fa-question-circle mr-1"></i> 帮助
          </a>
          <a href="#" class="hover:text-gray-200 transition-custom flex items-center">
            <i class="fa fa-info-circle mr-1"></i> 关于
          </a>
        </div>
      </div>
    </div>
  </header>

  <!-- 主内容区 -->
  <main class="container mx-auto px-4 py-8">
    <!-- 介绍部分 -->
    <section class="text-center mb-12 max-w-3xl mx-auto">
      <h2 class="text-[clamp(1.25rem,2.5vw,1.75rem)] font-bold text-neutral mb-4">简单高效的图片压缩解决方案</h2>
      <p class="text-gray-600 mb-6">上传图片，选择压缩质量和格式，一键压缩并下载。保持图片质量的同时显著减小文件大小。</p>
      
      <!-- 格式选择器 -->
      <div class="mb-8 bg-white p-4 rounded-lg shadow-md inline-block">
        <label for="format-select" class="block text-sm font-medium text-gray-700 mb-2">选择输出格式：</label>
        <div class="flex flex-wrap gap-2 justify-center" id="format-options">
          <button class="format-btn bg-primary text-white px-4 py-2 rounded-md hover:bg-primary/90 transition-custom active" data-format="jpg">JPG</button>
          <button class="format-btn bg-gray-200 text-gray-700 px-4 py-2 rounded-md hover:bg-gray-300 transition-custom" data-format="png">PNG</button>
          <button class="format-btn bg-gray-200 text-gray-700 px-4 py-2 rounded-md hover:bg-gray-300 transition-custom" data-format="webp">WebP</button>
          <button class="format-btn bg-gray-200 text-gray-700 px-4 py-2 rounded-md hover:bg-gray-300 transition-custom" data-format="avif">AVIF</button>
        </div>
        <input type="hidden" id="format-select" value="jpg">
      </div>
    </section>

    <!-- 上传区域 -->
    <section class="mb-12">
      <div id="drop-area" class="border-2 border-dashed border-gray-300 rounded-xl p-8 text-center hover:border-primary transition-custom bg-white shadow-sm">
        <div id="upload-icon" class="mx-auto w-16 h-16 mb-4 text-gray-400">
          <i class="fa fa-cloud-upload text-5xl"></i>
        </div>
        <h3 class="text-lg font-medium text-gray-700 mb-2">拖放图片到此处，或点击上传</h3>
        <p class="text-sm text-gray-500 mb-6">支持 JPG, PNG, WebP, AVIF 格式，单张图片最大 10MB</p>
        <label class="inline-block bg-primary text-white px-6 py-3 rounded-lg font-medium cursor-pointer hover:bg-primary/90 transition-custom shadow-md">
          <i class="fa fa-picture-o mr-2"></i>选择图片
          <input type="file" id="file-input" accept="image/*" class="hidden">
        </label>
        <div id="file-name" class="mt-4 text-sm text-gray-600 hidden"></div>
      </div>
    </section>

    <!-- 压缩设置 -->
    <section id="compression-settings" class="mb-12 hidden">
      <div class="bg-white rounded-xl shadow-md p-6">
        <h3 class="text-lg font-semibold text-gray-800 mb-4">压缩设置</h3>
        
        <div class="mb-6">
          <div class="flex justify-between mb-2">
            <label for="quality-slider" class="text-gray-700 font-medium">压缩质量</label>
            <span id="quality-value" class="text-primary font-semibold">80%</span>
          </div>
          <input 
            type="range" 
            id="quality-slider" 
            min="1" 
            max="100" 
            value="80" 
            class="w-full h-2 bg-gray-200 rounded-lg appearance-none cursor-pointer accent-primary"
          >
          <div class="flex justify-between text-xs text-gray-500 mt-1">
            <span>更高压缩率</span>
            <span>更高质量</span>
          </div>
        </div>
        
        <div class="flex justify-between items-center">
          <div>
            <p class="text-sm text-gray-600">预估压缩后大小:</p>
            <p id="estimated-size" class="text-lg font-semibold text-secondary">--</p>
          </div>
          <button id="compress-btn" class="bg-secondary text-white px-6 py-3 rounded-lg font-medium hover:bg-secondary/90 transition-custom shadow-md flex items-center">
            <i class="fa fa-compress mr-2"></i>开始压缩
          </button>
        </div>
      </div>
    </section>

    <!-- 压缩结果 -->
    <section id="compression-result" class="mb-12 hidden">
      <div class="bg-white rounded-xl shadow-md p-6">
        <h3 class="text-lg font-semibold text-gray-800 mb-6">压缩结果对比</h3>
        
        <div class="grid grid-cols-1 md:grid-cols-2 gap-8">
          <!-- 原图 -->
          <div>
            <h4 class="text-sm font-medium text-gray-600 mb-3 flex items-center">
              <i class="fa fa-image mr-2 text-gray-400"></i> 原始图片
            </h4>
            <div class="border border-gray-200 rounded-lg overflow-hidden bg-gray-50 flex items-center justify-center min-h-[200px]">
              <img id="original-image" src="" alt="原始图片" class="max-w-full max-h-[300px] object-contain">
            </div>
            <div class="mt-3 text-sm text-gray-600">
              <p>尺寸: <span id="original-dimensions">--</span></p>
              <p>大小: <span id="original-size">--</span></p>
              <p>格式: <span id="original-format">--</span></p>
            </div>
          </div>
          
          <!-- 压缩后图片 -->
          <div>
            <h4 class="text-sm font-medium text-gray-600 mb-3 flex items-center">
              <i class="fa fa-check-circle mr-2 text-secondary"></i> 压缩后图片
            </h4>
            <div class="border border-gray-200 rounded-lg overflow-hidden bg-gray-50 flex items-center justify-center min-h-[200px]">
              <img id="compressed-image" src="" alt="压缩后图片" class="max-w-full max-h-[300px] object-contain">
            </div>
            <div class="mt-3 text-sm text-gray-600">
              <p>尺寸: <span id="compressed-dimensions">--</span></p>
              <p>大小: <span id="compressed-size">--</span></p>
              <p>格式: <span id="compressed-format">--</span></p>
              <p class="text-secondary font-medium mt-1">
                <i class="fa fa-tachometer mr-1"></i> 节省: <span id="savings-percentage">--</span>
              </p>
            </div>
          </div>
        </div>
        
        <div class="mt-8 flex justify-center">
          <button id="download-btn" class="bg-accent text-white px-8 py-3 rounded-lg font-medium hover:bg-accent/90 transition-custom shadow-md flex items-center">
            <i class="fa fa-download mr-2"></i>下载压缩图片
          </button>
        </div>
        
        <div class="mt-6 text-center">
          <button id="compress-another-btn" class="text-primary hover:text-primary/80 transition-custom font-medium">
            <i class="fa fa-plus-circle mr-1"></i>压缩另一张图片
          </button>
        </div>
      </div>
    </section>

    <!-- 功能特点 -->
    <section class="mb-12">
      <h3 class="text-xl font-bold text-center text-neutral mb-8">为什么选择我们的压缩工具</h3>
      
      <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
        <div class="bg-white p-6 rounded-xl shadow-sm hover:shadow-custom transition-custom">
          <div class="w-12 h-12 bg-primary/10 rounded-full flex items-center justify-center mb-4">
            <i class="fa fa-bolt text-primary text-xl"></i>
          </div>
          <h4 class="font-semibold text-gray-800 mb-2">快速高效</h4>
          <p class="text-gray-600 text-sm">本地压缩处理，无需上传到服务器，保护隐私同时速度更快。</p>
        </div>
        
        <div class="bg-white p-6 rounded-xl shadow-sm hover:shadow-custom transition-custom">
          <div class="w-12 h-12 bg-secondary/10 rounded-full flex items-center justify-center mb-4">
            <i class="fa fa-balance-scale text-secondary text-xl"></i>
          </div>
          <h4 class="font-semibold text-gray-800 mb-2">质量与大小平衡</h4>
          <p class="text-gray-600 text-sm">智能算法确保在减小文件大小的同时，保持最佳视觉质量。</p>
        </div>
        
        <div class="bg-white p-6 rounded-xl shadow-sm hover:shadow-custom transition-custom">
          <div class="w-12 h-12 bg-accent/10 rounded-full flex items-center justify-center mb-4">
            <i class="fa fa-code-fork text-accent text-xl"></i>
          </div>
          <h4 class="font-semibold text-gray-800 mb-2">多格式支持</h4>
          <p class="text-gray-600 text-sm">支持多种主流图片格式，包括最新的WebP和AVIF高效格式。</p>
        </div>
      </div>
    </section>
  </main>

  <!-- 页脚 -->
  <footer class="bg-neutral text-white py-8">
    <div class="container mx-auto px-4">
      <div class="flex flex-col md:flex-row justify-between items-center">
        <div class="mb-4 md:mb-0">
          <div class="flex items-center space-x-2">
            <i class="fa fa-compress"></i>
            <span class="font-bold">图片压缩工具</span>
          </div>
          <p class="text-gray-400 text-sm mt-2">简单、高效的在线图片压缩解决方案</p>
        </div>
        
        <div class="flex space-x-6">
          <a href="#" class="text-gray-400 hover:text-white transition-custom">
            <i class="fa fa-github text-xl"></i>
          </a>
          <a href="#" class="text-gray-400 hover:text-white transition-custom">
            <i class="fa fa-twitter text-xl"></i>
          </a>
          <a href="#" class="text-gray-400 hover:text-white transition-custom">
            <i class="fa fa-envelope text-xl"></i>
          </a>
        </div>
      </div>
      
      <div class="border-t border-gray-700 mt-6 pt-6 text-center text-gray-400 text-sm">
        &copy; 2023 图片压缩工具 - 保留所有权利
      </div>
    </div>
  </footer>

  <!-- 通知提示 -->
  <div id="toast" class="fixed bottom-6 right-6 bg-gray-800 text-white px-6 py-3 rounded-lg shadow-lg transform translate-y-20 opacity-0 transition-custom flex items-center">
    <i id="toast-icon" class="fa fa-check-circle mr-2"></i>
    <span id="toast-message"></span>
  </div>

  <script>
    // 全局变量
    let originalImageData = null;
    let compressedImageData = null;
    
    // DOM 元素
    const dropArea = document.getElementById('drop-area');
    const fileInput = document.getElementById('file-input');
    const fileName = document.getElementById('file-name');
    const compressionSettings = document.getElementById('compression-settings');
    const qualitySlider = document.getElementById('quality-slider');
    const qualityValue = document.getElementById('quality-value');
    const estimatedSize = document.getElementById('estimated-size');
    const compressBtn = document.getElementById('compress-btn');
    const compressionResult = document.getElementById('compression-result');
    const originalImage = document.getElementById('original-image');
    const compressedImage = document.getElementById('compressed-image');
    const originalDimensions = document.getElementById('original-dimensions');
    const originalSize = document.getElementById('original-size');
    const originalFormat = document.getElementById('original-format');
    const compressedDimensions = document.getElementById('compressed-dimensions');
    const compressedSize = document.getElementById('compressed-size');
    const compressedFormat = document.getElementById('compressed-format');
    const savingsPercentage = document.getElementById('savings-percentage');
    const downloadBtn = document.getElementById('download-btn');
    const compressAnotherBtn = document.getElementById('compress-another-btn');
    const toast = document.getElementById('toast');
    const toastIcon = document.getElementById('toast-icon');
    const toastMessage = document.getElementById('toast-message');
    const formatOptions = document.getElementById('format-options');
    const formatBtns = document.querySelectorAll('.format-btn');
    const formatSelect = document.getElementById('format-select');
    
    // 格式选择
    formatBtns.forEach(btn => {
      btn.addEventListener('click', () => {
        // 移除所有按钮的active状态
        formatBtns.forEach(b => {
          b.classList.remove('bg-primary', 'text-white');
          b.classList.add('bg-gray-200', 'text-gray-700');
          b.classList.remove('active');
        });
        
        // 设置当前按钮为active状态
        btn.classList.remove('bg-gray-200', 'text-gray-700');
        btn.classList.add('bg-primary', 'text-white');
        btn.classList.add('active');
        
        // 更新隐藏输入框的值
        formatSelect.value = btn.dataset.format;
        
        // 如果已经上传了图片，重新计算预估大小
        if (originalImageData) {
          updateEstimatedSize();
        }
      });
    });
    
    // 拖放功能
    ['dragenter', 'dragover', 'dragleave', 'drop'].forEach(eventName => {
      dropArea.addEventListener(eventName, preventDefaults, false);
    });
    
    function preventDefaults(e) {
      e.preventDefault();
      e.stopPropagation();
    }
    
    ['dragenter', 'dragover'].forEach(eventName => {
      dropArea.addEventListener(eventName, highlight, false);
    });
    
    ['dragleave', 'drop'].forEach(eventName => {
      dropArea.addEventListener(eventName, unhighlight, false);
    });
    
    function highlight() {
      dropArea.classList.add('border-primary');
      dropArea.classList.add('bg-primary/5');
    }
    
    function unhighlight() {
      dropArea.classList.remove('border-primary');
      dropArea.classList.remove('bg-primary/5');
    }
    
    dropArea.addEventListener('drop', handleDrop, false);
    
    function handleDrop(e) {
      const dt = e.dataTransfer;
      const file = dt.files[0];
      handleFiles(file);
    }
    
    // 文件选择
    fileInput.addEventListener('change', function() {
      if (this.files.length) {
        handleFiles(this.files[0]);
      }
    });
    
    dropArea.addEventListener('click', () => {
      fileInput.click();
    });
    
    // 处理文件
    function handleFiles(file) {
      if (!file.type.match('image.*')) {
        showToast('请上传图片文件', 'error');
        return;
      }
      
      if (file.size > 10 * 1024 * 1024) {
        showToast('图片大小不能超过10MB', 'error');
        return;
      }
      
      // 显示文件名
      fileName.textContent = file.name;
      fileName.classList.remove('hidden');
      
      // 保存原始图片数据
      originalImageData = {
        file: file,
        size: file.size,
        type: file.type
      };
      
      // 显示压缩设置
      compressionSettings.classList.remove('hidden');
      
      // 读取图片并显示
      const reader = new FileReader();
      reader.onload = function(e) {
        const img = new Image();
        img.onload = function() {
          originalImageData.width = img.width;
          originalImageData.height = img.height;
          originalImage.src = e.target.result;
          originalDimensions.textContent = `${img.width} × ${img.height} 像素`;
          originalSize.textContent = formatFileSize(file.size);
          
          // 提取文件格式
          const format = file.type.split('/')[1].toUpperCase();
          originalFormat.textContent = format;
          
          // 更新预估大小
          updateEstimatedSize();
        };
        img.src = e.target.result;
      };
      reader.readAsDataURL(file);
    }
    
    // 质量滑块事件
    qualitySlider.addEventListener('input', function() {
      qualityValue.textContent = `${this.value}%`;
      updateEstimatedSize();
    });
    
    // 更新预估压缩后大小（改进的算法）
    function updateEstimatedSize() {
      if (!originalImageData) return;
      
      const quality = qualitySlider.value / 100;
      const format = formatSelect.value;
      
      // 基于不同格式和质量的压缩率估算模型
      let compressionRatio;
      
      switch(format) {
        case 'jpg':
          // JPG压缩率模型：质量越低，压缩率越高
          compressionRatio = 0.01 + (1 - quality) * 0.7;
          break;
        case 'png':
          // PNG压缩率模型：压缩率相对稳定，受质量影响较小
          compressionRatio = 0.2 + (1 - quality) * 0.3;
          break;
        case 'webp':
          // WebP压缩率模型：比JPG更高效
          compressionRatio = 0.01 + (1 - quality) * 0.8;
          break;
        case 'avif':
          // AVIF压缩率模型：目前最高效的格式
          compressionRatio = 0.01 + (1 - quality) * 0.9;
          break;
        default:
          compressionRatio = 0.5;
      }
      
      // 考虑图片内容复杂度的修正因子
      // 简单图片（如图标、线条图）压缩率更高
      // 复杂图片（如照片）压缩率较低
      let contentFactor = 1;
      const isSimpleImage = originalImageData.width < 500 && originalImageData.height < 500;
      if (isSimpleImage && format !== 'png') {
        contentFactor = 1.3; // 简单图片压缩效果更好
      }
      
      // 计算预估大小
      const estimated = originalImageData.size * (1 - compressionRatio * contentFactor);
      estimatedSize.textContent = formatFileSize(estimated);
    }
    
    // 压缩图片
    compressBtn.addEventListener('click', compressImage);
    
    function compressImage() {
      if (!originalImageData) return;
      
      // 显示加载状态
      compressBtn.disabled = true;
      compressBtn.innerHTML = '<i class="fa fa-spinner fa-spin mr-2"></i>压缩中...';
      
      const img = new Image();
      img.onload = function() {
        const canvas = document.createElement('canvas');
        const ctx = canvas.getContext('2d');
        
        // 设置画布尺寸为原始尺寸
        canvas.width = img.width;
        canvas.height = img.height;
        
        // 绘制图片
        ctx.drawImage(img, 0, 0);
        
        const quality = qualitySlider.value / 100;
        const format = formatSelect.value;
        
        // 根据选择的格式进行压缩
        let mimeType;
        switch(format) {
          case 'jpg':
            mimeType = 'image/jpeg';
            break;
          case 'png':
            mimeType = 'image/png';
            break;
          case 'webp':
            mimeType = 'image/webp';
            break;
          case 'avif':
            mimeType = 'image/avif';
            break;
        }
        
        // 转换为Blob并获取大小
        canvas.toBlob(blob => {
          compressedImageData = {
            blob: blob,
            url: URL.createObjectURL(blob),
            size: blob.size,
            width: img.width,
            height: img.height,
            type: mimeType
          };
          
          // 更新结果显示
          compressedImage.src = compressedImageData.url;
          compressedDimensions.textContent = `${img.width} × ${img.height} 像素`;
          compressedSize.textContent = formatFileSize(blob.size);
          compressedFormat.textContent = format.toUpperCase();
          
          // 计算节省比例
          const savings = 100 - (blob.size / originalImageData.size * 100);
          savingsPercentage.textContent = `${Math.round(savings)}%`;
          
          // 显示结果区域
          compressionResult.classList.remove('hidden');
          
          // 恢复按钮状态
          compressBtn.disabled = false;
          compressBtn.innerHTML = '<i class="fa fa-compress mr-2"></i>开始压缩';
          
          // 滚动到结果区域
          compressionResult.scrollIntoView({ behavior: 'smooth' });
          
          showToast('图片压缩成功', 'success');
        }, mimeType, quality);
      };
      
      // 加载原始图片
      img.src = originalImage.src;
    }
    
    // 下载图片
    downloadBtn.addEventListener('click', () => {
      if (!compressedImageData) return;
      
      const a = document.createElement('a');
      a.href = compressedImageData.url;
      
      // 生成文件名
      const originalName = originalImageData.file.name;
      const nameWithoutExt = originalName.substring(0, originalName.lastIndexOf('.')) || originalName;
      a.download = `${nameWithoutExt}-compressed.${formatSelect.value}`;
      
      document.body.appendChild(a);
      a.click();
      document.body.removeChild(a);
      
      showToast('图片已下载', 'success');
    });
    
    // 压缩另一张图片
    compressAnotherBtn.addEventListener('click', () => {
      // 重置状态
      fileInput.value = '';
      fileName.classList.add('hidden');
      fileName.textContent = '';
      compressionResult.classList.add('hidden');
      originalImageData = null;
      compressedImageData = null;
      
      // 滚动到上传区域
      dropArea.scrollIntoView({ behavior: 'smooth' });
    });
    
    // 工具函数：格式化文件大小
    function formatFileSize(bytes) {
      if (bytes === 0) return '0 Bytes';
      
      const k = 1024;
      const sizes = ['Bytes', 'KB', 'MB', 'GB'];
      const i = Math.floor(Math.log(bytes) / Math.log(k));
      
      return parseFloat((bytes / Math.pow(k, i)).toFixed(2)) + ' ' + sizes[i];
    }
    
    // 显示提示信息
    function showToast(message, type = 'info') {
      toastMessage.textContent = message;
      
      // 设置图标和颜色
      if (type === 'success') {
        toastIcon.className = 'fa fa-check-circle mr-2';
        toast.classList.remove('bg-red-600', 'bg-blue-600');
        toast.classList.add('bg-green-600');
      } else if (type === 'error') {
        toastIcon.className = 'fa fa-exclamation-circle mr-2';
        toast.classList.remove('bg-green-600', 'bg-blue-600');
        toast.classList.add('bg-red-600');
      } else {
        toastIcon.className = 'fa fa-info-circle mr-2';
        toast.classList.remove('bg-green-600', 'bg-red-600');
        toast.classList.add('bg-blue-600');
      }
      
      // 显示提示
      toast.classList.remove('translate-y-20', 'opacity-0');
      toast.classList.add('translate-y-0', 'opacity-100');
      
      // 3秒后隐藏
      setTimeout(() => {
        toast.classList.remove('translate-y-0', 'opacity-100');
        toast.classList.add('translate-y-20', 'opacity-0');
      }, 3000);
    }
  </script>
</body>
</html>
